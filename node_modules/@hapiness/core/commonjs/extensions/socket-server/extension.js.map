{"version":3,"file":"extension.js","sourceRoot":"","sources":["../../../../src/extensions/socket-server/extension.ts"],"names":[],"mappings":";;AACA,gDAA6C;AAC7C,qCAA2C;AAC3C,qCAA0E;AAe1E;IAEW,MAAM,CAAC,SAAS,CAAC,MAAoB;QACxC,OAAO;YACH,KAAK,EAAE,eAAe;YACtB,MAAM;SACT,CAAC;IACN,CAAC;IAED;;;;;;;OAOG;IACH,eAAe,CAAC,MAAkB,EAAE,MAAoB;QACpD,OAAO,uBAAU;aACZ,EAAE,CAAC,IAAI,wBAAe,CAAC,MAAM,CAAC,CAAC;aAC/B,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACP,QAAQ,EAAE,IAAI;YACd,KAAK,EAAE,eAAe;YACtB,KAAK,EAAE,CAAC;SACX,CAAC,CAAC,CAAC;IACZ,CAAC;IAED;;;;;;OAMG;IACH,oBAAoB,CAAC,MAAkB,EAAE,MAAuB;QAC5D,OAAO,uBAAU;aACZ,EAAE,CAAC,MAAM,CAAC;aACV,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC;IAC7B,CAAC;IAED;;;;;;OAMG;IACH,UAAU,CAAC,MAAkB,EAAE,MAAuB;QAClD,OAAO;YACH,QAAQ,EAAE,gCAAyB,CAAC,SAAS;YAC7C,QAAQ,EAAE,MAAM,CAAC,IAAI,EAAE;SAC1B,CAAA;IACL,CAAC;CACJ;AArDD,0CAqDC","sourcesContent":["import { CoreModule, Extension, ExtensionWithConfig, OnExtensionLoad, OnModuleInstantiated, OnShutdown } from '../../core/interfaces';\nimport { Observable } from 'rxjs/Observable';\nimport { WebSocketServer } from './server';\nimport { ExtensionShutdown, ExtensionShutdownPriority } from '../../core';\n\nexport interface SocketConfig {\n    port?: number;\n    autoAcceptConnections?: boolean;\n    keepaliveInterval?: number;\n    keepaliveGracePeriod?: number;\n    closeTimeout?: number;\n    useHttpExtension?: boolean;\n    tls?: {\n        key: Buffer;\n        cert: Buffer;\n    }\n}\n\nexport class SocketServerExt implements OnExtensionLoad, OnModuleInstantiated, OnShutdown {\n\n    public static setConfig(config: SocketConfig): ExtensionWithConfig {\n        return {\n            token: SocketServerExt,\n            config\n        };\n    }\n\n    /**\n     * Initilization of the extension\n     * Create the socket server\n     *\n     * @param  {CoreModule} module\n     * @param  {SocketConfig} config\n     * @returns Observable\n     */\n    onExtensionLoad(module: CoreModule, config: SocketConfig): Observable<Extension> {\n        return Observable\n            .of(new WebSocketServer(config))\n            .map(_ => ({\n                instance: this,\n                token: SocketServerExt,\n                value: _\n            }));\n    }\n\n    /**\n     * Start socket server\n     *\n     * @param  {CoreModule} module\n     * @param  {WebSocketServer} server\n     * @returns Observable\n     */\n    onModuleInstantiated(module: CoreModule, server: WebSocketServer): Observable<any> {\n        return Observable\n            .of(server)\n            .map(_ => _.start());\n    }\n\n    /**\n     * Shutdown HapiJS server extension\n     *\n     * @param  {CoreModule} module\n     * @param  {Server} server\n     * @returns ExtensionShutdown\n     */\n    onShutdown(module: CoreModule, server: WebSocketServer): ExtensionShutdown {\n        return {\n            priority: ExtensionShutdownPriority.IMPORTANT,\n            resolver: server.stop()\n        }\n    }\n}\n"]}